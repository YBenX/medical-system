# AI智能门诊诊疗系统 - 项目说明

## 项目概述

本项目是一个完整的AI驱动的门诊诊疗管理系统，实现了以下核心功能：

### ✅ 已完成功能

#### 1. 后端系统 (.NET 9)

**数据模型设计**
- ✅ Patient（患者）- 包含基本信息、病史、过敏史等
- ✅ Doctor（医生）- 医生信息、职称、科室、擅长领域
- ✅ Schedule（排班）- 医生排班管理
- ✅ Appointment（预约）- 预约记录管理
- ✅ MedicalRecord（病历）- 完整的病历记录
- ✅ Medicine（药品）- 药品库存管理
- ✅ Prescription（处方）- 处方主表
- ✅ PrescriptionDetail（处方明细）- 处方药品详情
- ✅ Charge（收费）- 费用记录
- ✅ ConversationHistory（会话历史）- AI对话记录

**API接口**
- ✅ 聊天接口（/api/chat）
  - 发送消息
  - 获取历史
  - 清除历史

- ✅ 患者管理（/api/patients）
  - CRUD操作
  - 搜索功能

- ✅ 预约管理（/api/appointments）
  - 创建预约
  - 取消预约
  - 查询预约

- ✅ 医生和排班（/api/doctors）
  - 医生列表
  - 排班查询

**AI集成**
- ✅ 支持DeepSeek API
- ✅ 支持Qwen API
- ✅ 可配置的AI服务提供商
- ✅ 完整的Prompt工程设计
- ✅ 上下文管理和对话历史

#### 2. 前端系统 (Vue 3 + Element UI Plus)

**核心组件**
- ✅ ChatWindow - AI会话窗口组件
- ✅ PatientForm - 患者建档表单组件

**页面功能**
- ✅ AI会话页面
  - 实时对话
  - 历史记录
  - 快捷操作

- ✅ 患者管理页面
  - 患者列表
  - 搜索功能
  - 新建/编辑

- ✅ 预约挂号页面
  - 科室选择
  - 医生选择
  - 时间选择
  - 在线预约

**API封装**
- ✅ 统一的Axios配置
- ✅ 请求/响应拦截器
- ✅ 错误处理
- ✅ 模块化API接口

#### 3. 数据库设计

- ✅ SQLite数据库
- ✅ Entity Framework Core 9集成
- ✅ 完整的关系配置
- ✅ 索引优化
- ✅ 级联删除策略

#### 4. 项目文档

- ✅ README.md - 完整的使用说明
- ✅ 需求.md - 详细需求文档
- ✅ init-data.sql - 测试数据初始化脚本

## 项目结构

```
MZ/
├── backend/                          # 后端项目
│   ├── Controllers/                  # API控制器
│   │   ├── ChatController.cs        # 聊天API
│   │   ├── PatientsController.cs    # 患者管理API
│   │   ├── AppointmentsController.cs # 预约API
│   │   └── DoctorsController.cs     # 医生API
│   │
│   ├── Models/                       # 数据模型
│   │   ├── Patient.cs
│   │   ├── Doctor.cs
│   │   ├── Schedule.cs
│   │   ├── Appointment.cs
│   │   ├── MedicalRecord.cs
│   │   ├── Medicine.cs
│   │   ├── Prescription.cs
│   │   ├── PrescriptionDetail.cs
│   │   ├── Charge.cs
│   │   └── ConversationHistory.cs
│   │
│   ├── Data/
│   │   └── MedicalDbContext.cs      # EF Core上下文
│   │
│   ├── Services/                     # 业务服务
│   │   ├── IAIService.cs
│   │   └── AIService.cs             # AI服务实现
│   │
│   ├── DTOs/                         # 数据传输对象
│   │   ├── ChatDTOs.cs
│   │   ├── PatientDTOs.cs
│   │   └── AppointmentDTOs.cs
│   │
│   ├── Program.cs                    # 程序入口
│   ├── appsettings.json             # 配置文件
│   ├── MedicalSystem.csproj         # 项目文件
│   └── init-data.sql                # 初始化数据
│
├── frontend/                         # 前端项目
│   ├── src/
│   │   ├── api/                     # API接口
│   │   │   ├── axios.js
│   │   │   ├── chat.js
│   │   │   ├── patient.js
│   │   │   ├── appointment.js
│   │   │   └── doctor.js
│   │   │
│   │   ├── components/              # Vue组件
│   │   │   ├── ChatWindow.vue
│   │   │   └── PatientForm.vue
│   │   │
│   │   ├── App.vue                  # 主应用
│   │   └── main.js                  # 入口文件
│   │
│   └── package.json
│
├── README.md                         # 使用说明
├── 需求.md                           # 需求文档
└── 项目说明.md                       # 本文件
```

## 技术亮点

### 1. AI智能对话
- 基于大模型的自然语言理解
- 智能意图识别
- 上下文记忆功能
- 专业的医疗助理角色设定

### 2. 现代化架构
- .NET 9 Minimal API
- Vue 3 Composition API
- Entity Framework Core 9
- RESTful API设计

### 3. 用户体验
- 响应式设计
- Element UI Plus组件库
- 实时消息显示
- 友好的错误提示

### 4. 数据管理
- 完整的数据模型设计
- 关系型数据库
- 数据验证和约束
- 级联操作支持

## 使用说明

### 环境要求

1. **后端**
   - .NET 9 SDK
   - SQLite（自动创建）

2. **前端**
   - Node.js 16+
   - npm 或 yarn

3. **AI服务**
   - DeepSeek API密钥 或 Qwen API密钥

### 快速启动

1. **配置AI密钥**
   ```bash
   # 编辑 backend/appsettings.json
   # 修改 AI:DeepSeek:ApiKey 或 AI:Qwen:ApiKey
   ```

2. **启动后端**
   ```bash
   cd backend
   dotnet run
   # 运行在 http://localhost:5000
   ```

3. **初始化数据（可选）**
   ```bash
   # 使用SQLite工具执行 init-data.sql
   # 或通过API手动创建数据
   ```

4. **启动前端**
   ```bash
   cd frontend
   npm install
   npm run dev
   # 运行在 http://localhost:5173
   ```

5. **访问应用**
   - 打开浏览器访问 http://localhost:5173
   - 开始使用AI智能门诊系统

## 功能演示流程

### 1. 患者建档
1. 点击"AI会话"标签
2. 点击"患者建档"按钮或对话输入"我要建档"
3. 填写患者信息表单
4. 提交完成建档

### 2. 预约挂号
1. 切换到"预约挂号"标签
2. 选择科室（内科、外科等）
3. 选择医生
4. 选择日期和时段
5. 确认预约

### 3. AI会话
1. 在AI会话页面输入问题
2. AI会识别意图并给出回复
3. 可以进行多轮对话
4. 支持查询、建档、预约等操作

### 4. 患者管理
1. 切换到"患者管理"标签
2. 查看患者列表
3. 使用搜索功能查找患者
4. 点击"编辑"修改患者信息
5. 点击"病历"查看就诊记录

## 扩展开发指南

### 添加新功能

1. **后端新接口**
   - 在 Controllers 中创建控制器
   - 使用 [ApiController] 和 [Route] 注解
   - 实现业务逻辑

2. **前端新页面**
   - 在 api 目录创建API封装
   - 在 components 或 views 创建组件
   - 在 App.vue 中集成

3. **数据库新表**
   - 在 Models 中创建实体类
   - 在 MedicalDbContext 中添加 DbSet
   - 配置关系和约束

### 自定义AI行为

编辑 `backend/Services/AIService.cs` 的 `GetSystemPrompt()` 方法：

```csharp
private string GetSystemPrompt()
{
    return @"你是一位专业的医疗助理...

    // 在这里自定义AI的角色、行为和规则
    ";
}
```

## 待开发功能

以下功能在需求文档中提到，但当前版本未完全实现：

1. **医生看诊完整流程**
   - 病历记录界面
   - 处方开具界面
   - 诊断辅助

2. **收费模块**
   - 费用计算界面
   - 收费记录管理
   - 发票打印

3. **统计报表**
   - 医生工作量统计
   - 收费统计
   - 药品使用统计

4. **高级功能**
   - 流式AI响应（打字机效果）
   - 表单智能生成
   - 病历自动生成
   - 药品相互作用检查

## 常见问题

### Q: 如何更换AI服务提供商？
A: 修改 `appsettings.json` 中的 `AI:Provider` 为 "DeepSeek" 或 "Qwen"，并配置对应的API密钥。

### Q: 数据库文件在哪里？
A: SQLite数据库文件 `medical.db` 会在后端首次运行时自动创建在 backend 目录下。

### Q: 如何添加更多测试数据？
A: 执行 `backend/init-data.sql` 脚本，或通过前端界面手动添加。

### Q: 前端无法连接后端？
A: 检查 `frontend/src/api/axios.js` 中的 baseURL 是否正确，默认为 `http://localhost:5000/api`。

## 开发团队建议

1. **代码规范**
   - 后端使用C# 命名规范
   - 前端使用Vue/JavaScript风格指南
   - 统一的注释风格

2. **版本控制**
   - 使用Git进行版本管理
   - 建议的.gitignore配置：
     ```
     backend/bin/
     backend/obj/
     backend/*.db
     frontend/node_modules/
     frontend/dist/
     ```

3. **部署建议**
   - 后端：使用Docker容器化部署
   - 前端：使用Nginx托管静态文件
   - 数据库：生产环境建议使用PostgreSQL或MySQL

## 许可与贡献

- 本项目采用MIT许可证
- 欢迎提交Issue和Pull Request
- 贡献前请阅读开发规范

---

**项目完成时间**: 2025年10月3日
**技术栈**: .NET 9 + Vue 3 + SQLite + AI (DeepSeek/Qwen)
**开发状态**: 核心功能已完成，可扩展开发
